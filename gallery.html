<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Gallery of Crown Heights Academy.">
    <title>Gallery | Crown Heights Academy</title>
    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <nav class="navbar" style="background: var(--dark-purple);">
        <div class="container nav-container">
            <a href="index.html" class="logo"><img src="images/logo.png" alt="Crown Heights Academy"
                    style="height: 45px; margin-right: 10px;"> Crown Heights</a>
            <div class="menu-toggle"><i class="fa-solid fa-bars"></i></div>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="about.html" class="nav-link">About Us</a></li>
                <li><a href="academics.html" class="nav-link">Academics</a></li>
                <li><a href="admissions.html" class="nav-link">Admissions</a></li>
                <li><a href="news.html" class="nav-link">News & Events</a></li>
                <li><a href="gallery.html" class="nav-link" style="color: var(--primary-yellow);">Gallery</a></li>
                <li><a href="contact.html" class="btn btn-secondary text-dark">Contact Us</a></li>
                <li><button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                        <i class="fa-solid fa-moon"></i>
                    </button></li>
            </ul>
        </div>
    </nav>
    <header class="section-padding text-center" style="background: var(--light-purple); padding-top: 150px;">
        <div class="container">
            <span class="text-purple" style="font-weight: 600; text-transform: uppercase;">Campus Life</span>
            <h1 style="font-size: 3rem; margin-top: 10px;">Our Gallery</h1>
        </div>
    </header>
    <section class="section-padding">
        <div class="container">
            <div class="gallery-grid">
                <!-- Using available images multiple times for demo effect -->
                <div class="gallery-item animate-on-scroll">
                    <img src="images/event-sports.png" alt="Sports">
                    <div class="gallery-overlay"><i class="fa-solid fa-plus"></i></div>
                </div>
                <div class="gallery-item animate-on-scroll">
                    <img src="images/teacher-male.png" alt="Teacher">
                    <div class="gallery-overlay"><i class="fa-solid fa-plus"></i></div>
                </div>
                <div class="gallery-item animate-on-scroll">
                    <img src="images/event-science.jpg" alt="Science">
                    <div class="gallery-overlay"><i class="fa-solid fa-plus"></i></div>
                </div>
                <div class="gallery-item animate-on-scroll">
                    <img src="images/event-art.jpg" alt="Art">
                    <div class="gallery-overlay"><i class="fa-solid fa-plus"></i></div>
                </div>
                <div class="gallery-item animate-on-scroll">
                    <img src="images/principal.png" alt="Principal">
                    <div class="gallery-overlay"><i class="fa-solid fa-plus"></i></div>
                </div>
                <div class="gallery-item animate-on-scroll">
                    <img src="images/event-music.jpg" alt="Music Concert">
                    <div class="gallery-overlay"><i class="fa-solid fa-plus"></i></div>
                </div>
                <!-- Dynamic articles from Admin -->
                <div id="dynamic-gallery" style="display: contents;"></div>

                <!-- Admin Upload Trigger -->
                <div class="gallery-item animate-on-scroll" id="add-image-trigger" style="cursor: pointer;">
                    <div
                        style="height: 250px; background: var(--bg-gradient); display: flex; align-items: center; justify-content: center; color: white; border-radius: 20px;">
                        <i class="fa-solid fa-camera" style="font-size: 3rem;"></i>
                    </div>
                </div>
                <input type="file" id="gallery-file-input" style="display: none;" accept="image/*">
            </div>
        </div>
    </section>
    <footer style="background: var(--text-dark); color: white; padding-top: 50px; padding-bottom: 30px;">
        <div class="container text-center">
            <a href="admin.html"><img src="images/logo.png" alt="Crown Heights Academy"
                    style="height: 80px; margin-bottom: 15px;"></a>
            <h3 style="color: var(--primary-yellow); margin-bottom: 10px;">Crown Heights Academy</h3>
            <p style="color: #aaa;">&copy; 2026. All Rights Reserved.</p>
        </div>
    </footer>
    <!-- Lightbox Modal -->
    <div id="lightbox" class="lightbox">
        <div class="lightbox-content">
            <span class="lightbox-close">&times;</span>
            <img src="" alt="Expanded View" id="lightbox-img" class="lightbox-img">
        </div>
    </div>

    <script src="js/main.js"></script>
    <script type="module">
        import { db, collection, getDocs, query, orderBy } from './js/firebase-config.js';

        document.addEventListener('DOMContentLoaded', async function () {
            const container = document.getElementById('dynamic-gallery');
            if (!container) return;

            let images = [];

            // Try Firebase
            try {
                const q = query(collection(db, "gallery"), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                querySnapshot.forEach((doc) => {
                    images.push({ id: doc.id, ...doc.data() });
                });
            } catch (e) {
                console.warn("Firebase gallery fetch failed", e);
                // Fallback to local storage (manual parsing as admin.js might not be exposed as module)
                try {
                    images = JSON.parse(localStorage.getItem('crownheights_gallery')) || [];
                } catch (err) { }
            }

            if (images.length === 0) return;

            const html = images.map(img => `
                <div class="gallery-item animate-on-scroll" style="position: relative;">
                    <img src="${img.src}" alt="Gallery Image">
                    <div class="gallery-overlay" style="opacity: 0; pointer-events: none;"><i class="fa-solid fa-plus"></i></div>
                </div>
            `).join('');

            container.innerHTML = html;

            // Trigger animation observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('in-view');
                });
            }, { threshold: 0.1 });

            container.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
        });
    </script>
    <script src="js/admin.js" type="module"></script>
</body>

</html>